---
layout: post
title: jQuery as a Global Event Bus
date: 2012-10-17 08:00:40.000000000 -07:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- JavaScript
- Tutorials
tags:
- Event Driven
- jQuery
- WordPress
meta:
  yourls_shorturl: http://eam.me/ii
  _wpcom_is_markdown: '1'
  _edit_last: '2'
  _yoast_wpseo_focuskw: event bus
  _yoast_wpseo_title: jQuery as a Global Event Bus
  _yoast_wpseo_metadesc: An event bus makes code robust and flexible. WordPress's
    plugin API uses one in PHP. Here's how to use jQuery as an event bus in your JavaScript
    code.
  yourls_tweeted: '1'
  _scribe_content_analysis: O:8:"stdClass":7:{s:8:"docScore";s:3:"100";s:9:"docScoreE";a:0:{}s:11:"fleschScore";s:14:"very
    difficult";s:8:"keywords";a:11:{i:0;O:8:"stdClass":12:{s:3:"kwc";s:4:"2.63";s:3:"kwd";s:4:"1.79";s:3:"kwe";a:1:{i:0;s:4:"KwET";}s:3:"kwf";s:1:"7";s:3:"kwl";s:1:"3";s:7:"kwlText";s:11:"Significant";s:3:"kwo";s:1:"A";s:4:"kwod";s:109:"Congratulations,
    this term strikes a good balance between search optimization and copywriting best
    practices.";s:3:"kwp";s:6:"Medium";s:3:"kwr";s:1:"1";s:3:"kws";s:2:"10";s:4:"text";s:9:"wordpress";}i:1;O:8:"stdClass":12:{s:3:"kwc";s:1:"5";s:3:"kwd";s:4:"3.58";s:3:"kwe";a:0:{}s:3:"kwf";s:2:"14";s:3:"kwl";s:1:"1";s:7:"kwlText";s:7:"Primary";s:3:"kwo";s:1:"C";s:4:"kwod";s:139:"While
    your copywriting is strong, consider writing more about this topic on your site
    and/or use this term more frequently in your content.";s:3:"kwp";s:9:"Very High";s:3:"kwr";s:1:"2";s:3:"kws";s:1:"0";s:4:"text";s:5:"event";}i:2;O:8:"stdClass":12:{s:3:"kwc";s:4:"4.59";s:3:"kwd";s:4:"0.77";s:3:"kwe";a:1:{i:0;s:4:"KwEM";}s:3:"kwf";s:1:"3";s:3:"kwl";s:1:"1";s:7:"kwlText";s:7:"Primary";s:3:"kwo";s:1:"C";s:4:"kwod";s:139:"While
    your copywriting is strong, consider writing more about this topic on your site
    and/or use this term more frequently in your content.";s:3:"kwp";s:9:"Very High";s:3:"kwr";s:1:"4";s:3:"kws";s:1:"0";s:4:"text";s:12:"global
    event";}i:3;O:8:"stdClass":12:{s:3:"kwc";s:3:"4.8";s:3:"kwd";s:3:"2.3";s:3:"kwe";a:1:{i:0;s:5:"KwEMP";}s:3:"kwf";s:1:"9";s:3:"kwl";s:1:"1";s:7:"kwlText";s:7:"Primary";s:3:"kwo";s:1:"C";s:4:"kwod";s:139:"While
    your copywriting is strong, consider writing more about this topic on your site
    and/or use this term more frequently in your content.";s:3:"kwp";s:9:"Very High";s:3:"kwr";s:1:"3";s:3:"kws";s:1:"0";s:4:"text";s:6:"jquery";}i:4;O:8:"stdClass":12:{s:3:"kwc";s:4:"1.22";s:3:"kwd";s:4:"0.26";s:3:"kwe";a:2:{i:0;s:4:"KwET";i:1;s:4:"KwEM";}s:3:"kwf";s:1:"1";s:3:"kwl";s:1:"4";s:7:"kwlText";s:14:"Not
    Emphasized";s:3:"kwo";s:1:"D";s:4:"kwod";s:129:"You will need to do some work
    for this term, including improving your copywriting and writing more about this
    topic on your site.";s:3:"kwp";s:8:"Very Low";s:3:"kwr";s:2:"11";s:3:"kws";s:1:"0";s:4:"text";s:18:"javascript
    library";}i:5;O:8:"stdClass":12:{s:3:"kwc";s:4:"1.22";s:3:"kwd";s:4:"0.26";s:3:"kwe";a:2:{i:0;s:4:"KwET";i:1;s:4:"KwEM";}s:3:"kwf";s:1:"1";s:3:"kwl";s:1:"4";s:7:"kwlText";s:14:"Not
    Emphasized";s:3:"kwo";s:1:"D";s:4:"kwod";s:129:"You will need to do some work
    for this term, including improving your copywriting and writing more about this
    topic on your site.";s:3:"kwp";s:8:"Very Low";s:3:"kwr";s:1:"8";s:3:"kws";s:1:"0";s:4:"text";s:12:"event
    driven";}i:6;O:8:"stdClass":12:{s:3:"kwc";s:4:"1.22";s:3:"kwd";s:4:"0.26";s:3:"kwe";a:2:{i:0;s:4:"KwET";i:1;s:4:"KwEM";}s:3:"kwf";s:1:"1";s:3:"kwl";s:1:"4";s:7:"kwlText";s:14:"Not
    Emphasized";s:3:"kwo";s:1:"D";s:4:"kwod";s:129:"You will need to do some work
    for this term, including improving your copywriting and writing more about this
    topic on your site.";s:3:"kwp";s:8:"Very Low";s:3:"kwr";s:1:"9";s:3:"kws";s:1:"0";s:4:"text";s:9:"php
    event";}i:7;O:8:"stdClass":12:{s:3:"kwc";s:4:"1.22";s:3:"kwd";s:4:"0.26";s:3:"kwe";a:2:{i:0;s:4:"KwET";i:1;s:4:"KwEM";}s:3:"kwf";s:1:"1";s:3:"kwl";s:1:"4";s:7:"kwlText";s:14:"Not
    Emphasized";s:3:"kwo";s:1:"D";s:4:"kwod";s:129:"You will need to do some work
    for this term, including improving your copywriting and writing more about this
    topic on your site.";s:3:"kwp";s:8:"Very Low";s:3:"kwr";s:2:"10";s:3:"kws";s:1:"0";s:4:"text";s:8:"php
    code";}i:8;O:8:"stdClass":12:{s:3:"kwc";s:4:"1.63";s:3:"kwd";s:4:"0.26";s:3:"kwe";a:1:{i:0;s:4:"KwET";}s:3:"kwf";s:1:"1";s:3:"kwl";s:1:"4";s:7:"kwlText";s:14:"Not
    Emphasized";s:3:"kwo";s:1:"D";s:4:"kwod";s:129:"You will need to do some work
    for this term, including improving your copywriting and writing more about this
    topic on your site.";s:3:"kwp";s:8:"Very Low";s:3:"kwr";s:1:"5";s:3:"kws";s:1:"0";s:4:"text";s:10:"plugin
    api";}i:9;O:8:"stdClass":12:{s:3:"kwc";s:4:"1.43";s:3:"kwd";s:4:"0.26";s:3:"kwe";a:2:{i:0;s:4:"KwET";i:1;s:5:"KwEMP";}s:3:"kwf";s:1:"1";s:3:"kwl";s:1:"4";s:7:"kwlText";s:14:"Not
    Emphasized";s:3:"kwo";s:1:"D";s:4:"kwod";s:129:"You will need to do some work
    for this term, including improving your copywriting and writing more about this
    topic on your site.";s:3:"kwp";s:8:"Very Low";s:3:"kwr";s:1:"7";s:3:"kws";s:1:"0";s:4:"text";s:10:"javascript";}i:10;O:8:"stdClass":12:{s:3:"kwc";s:4:"1.43";s:3:"kwd";s:4:"0.26";s:3:"kwe";a:2:{i:0;s:4:"KwET";i:1;s:5:"KwEMP";}s:3:"kwf";s:1:"1";s:3:"kwl";s:1:"4";s:7:"kwlText";s:14:"Not
    Emphasized";s:3:"kwo";s:1:"D";s:4:"kwod";s:129:"You will need to do some work
    for this term, including improving your copywriting and writing more about this
    topic on your site.";s:3:"kwp";s:8:"Very Low";s:3:"kwr";s:1:"6";s:3:"kws";s:1:"0";s:4:"text";s:15:"javascript
    code";}}s:11:"scribeScore";s:2:"56";s:4:"tags";a:18:{i:0;s:9:"wordpress";i:1;s:5:"event";i:2;s:12:"global
    event";i:3;s:6:"jquery";i:4;s:18:"javascript library";i:5;s:12:"event driven";i:6;s:9:"php
    event";i:7;s:8:"php code";i:8;s:10:"plugin api";i:9;s:10:"javascript";i:10;s:15:"javascript
    code";i:11;s:21:"document object model";i:12;s:10:"event work";i:13;s:12:"custom
    event";i:14;s:10:"events bus";i:15;s:23:"cross-platform software";i:16;s:4:"java";i:17;s:4:"html";}s:7:"request";O:8:"stdClass":4:{s:10:"html_title";s:28:"jQuery
    as a Global Event Bus";s:11:"description";s:150:"An event bus makes code robust
    and flexible. WordPress's plugin API uses one in PHP. Here's how to use jQuery
    as an event bus in your JavaScript code.";s:7:"content";s:5981:"<p>Some time ago,
    I made a mistake.[ref]Actually, I make mistakes quite often. Daily in fact. But
    let's not dwell on this ...[/ref]  Rather than taking the time to truly understand
    how events worked in jQuery, I <a title="JavaScript Event Bus" href="http://eamann.com/tech/javascript-event-bus/">built
    my own JavaScript library</a> to handle event delegation.</p><p>It worked, but
    why reinvent the wheel?</p><p>It turns out jQuery is perfectly capable of serving
    as a <em>global</em> event bus for all of your code.  You just have to know how
    to use it.</p><h2>What is an Event Bus?</h2><p>In old-school programming models,
    every bit of code would talk to every other bit of code.  If one changed an element
    on a page or the data stored in an object, it would immediately tell everyone
    else working on that page or object about the change.  The central problem here
    is scalability - in order to keep things in sync, every piece of your code needs
    to know about every other piece of your code.</p><p>For a simple Hello World application,
    not a big deal.  For a larger program, though, this becomes a cumbersome nightmare.</p><p>An
    <em>event bus</em> alleviates this problem and allows you to write fully decoupled
    code.  Rather than looking at its neighbors to watch for changes, a piece of code
    will <em>subscribe</em> to an event through the event bus.  When another piece
    of code fires an event (again, through the event bus), every <em>observer</em>
    is notified.</p><h2>Why Use One?</h2><p>In WordPress, for example, this pattern
    takes the form of action and filter hooks.  You don't need to know when or where
    an action or filter is fired, you just need to know its name and what parameters
    are passed.  WordPress' core code doesn't know anything about your plugin, it
    just fires its actions and passes data through filters when needed.  Likewise,
    your plugin code doesn't know anything about the location of these hooks, only
    that they exist.</p><p>In this way, the [cci]do_action()[/cci]/[cci]apply_filters()[/cci]
    and [cci]add_action()[/cci]/[cci]add_filter()[/cci] functions serve as the API
    for a built-in PHP event bus.</p><p>This is actually what makes WordPress such
    an amazing platform to develop with.  It's nearly infinitely extensible through
    this event-driven API and very approachable for developers to begin tying new
    code into.  This kind of extensibility, when placed in themes and plugins, makes
    those systems equally extensible.</p><p>Decoupling your code also makes it less
    fragile.</p><p>If your PHP code is tied to a WordPress action, and that action
    is removed, your code will merely stop.  It won't necessarily break[ref]Unless,
    of course, you've written it in such a way that it fails under these conditions.[/ref],
    and WordPress will continue to function as before.  Likewise, if someone else's
    code is tied to your action, and they remove their code, nothing will stop working.</p><p>Consider
    this example code:</p><p>... example without actions</p><p>Versus this example
    code:</p><p>... example with actions</p><p>In the first example, you must always
    have the [cci]update_remote_database()[/cci] function present.  As the application
    grows, this function might move to a location far removed from where it's called.
     If, later on, the remote database is disabled, how do you stop calling it?  In
    the first example, you have to remove the function and look for where it's called
    to remove the reference as well.</p><p>In the second example, you just remove
    the hook.  The original callee doesn't change because, well, it wasn't actually
    calling the function directly in the first place.</p><h2>How jQuery Does It</h2><p>Events
    in jQuery are easy. If you want to listen to the click event on a particular element,
    you add your handler inside [cci]jQuery('#element-id').click(function() { ...
    });[/cci].  If you've done much web development work at all, you've seen code
    similar to that quite often.</p><p>But did you know jQuery supports custom events?</p><p>In
    reality, the [cci].click()[/cci] method is just shorthand for [cci].on('click')[/cci].
     Looking at the second way of registering a click event listener, you can easily
    see how this can be extended with custom events.</p><p>Let's say our code does
    some background processing of large chunks of data.[ref]I know, JavaScript is
    single-threaded.  However, there are ways you can chunk up the processing of large
    quantities of data using [cci]setTimeout()[/cci] so that the browser doesn't become
    non-responsive. You'll still need a way to know when it's done ...[/ref]  When
    the processing is complete, you want to trigger the "oliver-twist" event to let
    the system know you're ready for more data.</p><p>To do things <em>globally</em>,
    it's easiest to bind these events to the [cci]document[/cci] object rather than
    to specific elements of the DOM.  This way, they're accessible to everything,
    and your code doesn't need to know anything about the page markup to function
    - remember, it's all about decoupling.</p><p>In this example, we listen for the
    "oliver-twist" event and then pass in more data:</p><p>.. listen</p><p>Then, after
    our data is finished processing, we trigger the "oliver-twist" event:</p><p>...</p><h2>What's
    Next?</h2><p>Is your code extensible?  Does it use custom events to signal when
    it's starting to do something or completing execution?  Where could you add some
    custom events to make it easier for third-party libraries to tie themselves in?</p><p>The
    <a title="Plupload" href="http://www.plupload.com/">Plupload</a> library, for
    example, is a heavy user of custom events to let you know when files are added
    to a queue, uploaded, erred, etc.  It has proven to be a remarkably flexible library,
    and is hugely popular as a result - if you use WordPress and upload media, then
    you're already using it and didn't even know it.</p><p>Can <em>your</em> library
    be as flexible - and as widely used - as a result of enabling custom events?</p>";s:3:"url";s:25:"https://jumping-duck.com/";}}
  _yoast_wpseo_linkdex: '83'
  _wpghs_github_path: _posts/2012-10-17-jquery-as-a-global-event-bus.md
author:
  login: eamann
  email: eric@eamann.com
  display_name: Eric
  first_name: Eric
  last_name: Mann
permalink: "/tutorial/jquery-as-a-global-event-bus/"
---
<p>Some time ago, I made a mistake.[ref]Actually, I make mistakes quite often. Daily in fact. But let's not dwell on this ...[/ref] &nbsp;Rather than taking the time to truly understand how events worked in jQuery, I <a title="JavaScript Event Bus" href="http://eamann.com/tech/javascript-event-bus/">built my own JavaScript library</a> to handle event delegation.</p>
<p>It worked, but why reinvent the wheel?</p>
<p>It turns out jQuery is perfectly capable of serving as a <em>global</em> event bus for all of your code. &nbsp;You just have to know how to use it.<!--more--></p>
<h2>What is an Event Bus?</h2>
<p>In old-school programming models, every bit of code would talk to every other bit of code. &nbsp;If one changed an element on a page or the data stored in an object, it would immediately tell everyone else working on that page or object about the change. &nbsp;The central problem here is scalability - in order to keep things in sync, every piece of your code needs to know about every other piece of your code.</p>
<p>For a simple Hello World application, not a big deal. &nbsp;For a larger program, though, this becomes a cumbersome nightmare.</p>
<p>An <em>event bus</em> alleviates this problem and allows you to write fully decoupled code. &nbsp;Rather than looking at its neighbors to watch for changes, a piece of code will&nbsp;<em>subscribe</em> to an event through the event bus. &nbsp;When another piece of code fires an event (again, through the event bus), every <em>observer</em> is notified.</p>
<h2>Why Use One?</h2>
<p>In WordPress, for example, this pattern takes the form of action and filter hooks. &nbsp;You don't need to know when or where an action or filter is fired, you just need to know its name and what parameters are passed. &nbsp;WordPress' core code doesn't know anything about your plugin, it just fires its actions and passes data through filters when needed. &nbsp;Likewise, your plugin code doesn't know anything about the location of these hooks, only that they exist.</p>
<p>In this way, the [cci]do_action()[/cci]/[cci]apply_filters()[/cci] and [cci]add_action()[/cci]/[cci]add_filter()[/cci] functions serve as the API for a built-in PHP event bus.</p>
<p>This is actually what makes WordPress such an amazing platform to develop with. &nbsp;It's nearly infinitely extensible through this event-driven API and very approachable for developers to begin tying new code into. &nbsp;This kind of extensibility, when placed in themes and plugins, makes those systems equally extensible.</p>
<p>Decoupling your code also makes it less fragile.</p>
<p>If your PHP code is tied to a WordPress action, and that action is removed, your code will merely stop. &nbsp;It won't necessarily break[ref]Unless, of course, you've written it in such a way that it fails under these conditions.[/ref], and WordPress will continue to function as before. &nbsp;Likewise, if someone else's code is tied to your action, and they remove their code, nothing will stop working.</p>
<p>Consider this example code:</p>
<p><code lang="php"><br />
function update_remote_database() {<br />
  $database_url = 'http://someremotesite.com/db';<br />
  wp_remote_post(<br />
    $database_url,<br />
    array( 'body' => date_create( 'now ') )<br />
  );<br />
}</p>
<p>// In some other part of your code.<br />
// Maybe another file even ...<br />
wp_insert_post( $new_post_from_args );</p>
<p>update_remote_database();<br />
</code></p>
<p>Versus this example code:</p>
<p><code lang="php"><br />
function update_remote_database() {<br />
  $database_url = 'http://someremotesite.com/db';<br />
  wp_remote_post(<br />
    $database_url,<br />
    array( 'body' => date_create( 'now ') )<br />
  );<br />
}<br />
add_action( 'after_insert_post', 'update_remote_database' );</p>
<p>// In some other part of your code.<br />
// Maybe another file even ...<br />
wp_insert_post( $new_post_from_args );</p>
<p>do_action( 'after_insert_post', $new_post_from_args );<br />
</code></p>
<p>In the first example, you must always have the [cci]update_remote_database()[/cci] function present. &nbsp;As the application grows, this function might move to a location far removed from where it's called. &nbsp;If, later on, the remote database is disabled, how do you stop calling it? &nbsp;In the first example, you have to remove the function and look for where it's called to remove the reference as well.</p>
<p>In the second example, you just remove the hook. &nbsp;The original callee doesn't change because, well, it wasn't actually calling the function directly in the first place.</p>
<h2>How jQuery Does It</h2>
<p>Events in jQuery are easy. If you want to listen to the click event on a particular element, you add your handler inside [cci]jQuery('#element-id').click(function() { ... });[/cci]. &nbsp;If you've done much web development work at all, you've seen code similar to that quite often.</p>
<p>But did you know jQuery supports custom events?</p>
<p>In reality, the [cci].click()[/cci] method is just shorthand for [cci].on('click')[/cci]. &nbsp;Looking at the second way of registering a click event listener, you can easily see how this can be extended with custom events.</p>
<p>Let's say our code does some background processing of large chunks of data.[ref]I know, JavaScript is single-threaded. &nbsp;However, there are ways you can chunk up the processing of large quantities of data using [cci]setTimeout()[/cci] so that the browser doesn't become non-responsive. You'll still need a way to know when it's done ...[/ref] &nbsp;When the processing is complete, you want to trigger the "oliver-twist" event to let the system know you're ready for more data.</p>
<p>To do things <em>globally</em>, it's easiest to bind these events to the [cci]document[/cci] object rather than to specific elements of the DOM. &nbsp;This way, they're accessible to everything, and your code doesn't need to know anything about the page markup to function - remember, it's all about decoupling.</p>
<p>In this example, we listen for the "oliver-twist" event and then pass in more data:</p>
<p><code lang="js"><br />
$(document).on('olver-twist', function() {<br />
  if(has_more_data) {<br />
    process_data();<br />
  } else {<br />
    alert('Done!');<br />
  }<br />
});<br />
</code></p>
<p>Then, after our data is finished processing, we trigger the "oliver-twist" event:</p>
<p><code lang="js"><br />
function process_data() {<br />
  setTimeout( async_process_data, 100 );<br />
}</p>
<p>function async_process_data() {<br />
  do_something();</p>
<p>if(done) {<br />
    $(document).trigger('olver-twist');<br />
  } else {<br />
    setTimeout( async_process_data, 100 );<br />
  }<br />
}<br />
</code></p>
<h2>What's Next?</h2>
<p>Is your code extensible? &nbsp;Does it use custom events to signal when it's starting to do something or completing execution? &nbsp;Where could you add some custom events to make it easier for third-party libraries to tie themselves in?</p>
<p>The <a title="Plupload" href="http://www.plupload.com/">Plupload</a> library, for example, is a heavy user of custom events to let you know when files are added to a queue, uploaded, erred, etc. &nbsp;It has proven to be a remarkably flexible library, and is hugely popular as a result - if you use WordPress and upload media, then you're already using it and didn't even know it.</p>
<p>Can <em>your</em> library be as flexible - and as widely used - as a result of enabling custom events?</p>
