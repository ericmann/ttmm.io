<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
        <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>A Rookie Attempt at Cron in CentOS | Things that Matter Most</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="A Rookie Attempt at Cron in CentOS" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="For years, I used shared hosting systems exclusively for all my websites.  They were affordable, easy to manage, and required zero effort on my part to set up and maintain.  Unfortunately, I have a habit of rapidly outgrowing hosts and usually have to migrate to bigger and better servers about once a year.  I finally decided to bite the bullet and purchased a VPS hosting system with a great company called Atum last month. The advantage of this is that I have complete control over the VPS.  Whereas before I could only host websites, I can now host my own development repositories (currently rocking Subersion, Mercurial, and Git all on my server).  It protects me from the inevitable crashes of my aging computer systems, and makes life a lot easier for me. While reveling in my newfound power, though, I ran into a serious issue: I had no idea how to set things up! I&#39;d read this or that tutorial and get things off the ground.  Setting up Apache took a few tries.  I&#39;m still working on configuring email.  But the biggest challenge I&#39;ve faced thus far is setting up an automated Subversion-to-Git mirror that would run on a cron job. Recently, I started working on a project that needed to maintain an up-to-date mirror of WordPress&#39; Subversion repository ... in a Git repository.  It&#39;s easy enough to use git-svn to synchronize the repositories.  That I figured out pretty quick.  The challenge lies in automating the process.  It took me a month to figure out the right way to set up a cron job.  So, to save you the trouble, here&#39;s the process I took, heavily derived from steps outlined by Bob McWhirter. Set up the hosted repository My team elected to work with Gitorious.  It&#39;s a site that hosts public Git repositories for free, and it&#39;s not as crowded as GitHub.  So the first step is to set up an empty repository there.  You&#39;ll be pushing all of your Subversion stuff into it.  Mine is called &quot;Daybreak:&quot; http://gitorious.org/daybreak Set up a Git repository on your server Remember, the point here is to automate everything.  So we need to set up a Git repository on our server so the server can grab from Subversion and push it into Gitorious.  Log in to your server via SSH and make an empty repository somewhere: [cc lang=&quot;bash&quot;] cd /var/www/git/ mkdir daybreak cd daybreak git init [/cc] Next we need to tell the repository that it&#39;s cloning from a Subversion system and which branch to take up. [cc lang=&quot;bash&quot;] git svn init -T http://core.svn.wordpress.org/trunk/ [/cc] The -T reminds Git to grab trunk, only trunk, and nothing but trunk.  Yes, you could clone the branches as well, but I only want the latest development version in my repository.  That&#39;s what I&#39;m working with and everything else is noise. At this point, we have a Git repository with nothing in it.  We need to tell it to fetch the Subversion revision history, but here is where you need to be careful! WordPress has over 17,000 commits in core.  If you try to fetch everything, the task might never complete.  I say &quot;never&quot; because I tried ... walked away from the computer for several hours ... and came back to see I was still on revision 2,000.  Trust me, you won&#39;t ever need to revert that far, so grab a recent revision and fetch from there.  I picked RC3 (revision 17355). [cc lang=&quot;bash&quot;] git svn fetch -r 17355 [/cc] This command might run for a while, depending on how long it&#39;s been between the revision you&#39;re fetching and trunk&#39;s current head.  After it&#39;s done, make sure you run the garbage collector to clean things up a bit. [cc lang=&quot;bash&quot;] git gc [/cc] Set up your SSH credentials Once again, we want the server to be the one pushing these commits into the repository, so we have to do a few things to set up permission.  The first is set up a public/private key pair for use with Gitorious. [cc lang=&quot;bash&quot;] cd ~ ssh-keygen -t dsa -f .ssh/id_dsa_gitorious_mirroring [/cc] I usually go back to the root directory before running commands like this.  I don&#39;t know if there are any negative consequences of running the command elsewhere, this is just what I did. Next we want to edit our SSH configuration to use a &quot;fake&quot; host so any connection to Gitorious uses the key we just made. [cc lang=&quot;bash&quot;] cd /.ssh vim config [/cc] This opens the config file in vim.  You need to add the following: [cc lang=&quot;vim&quot;] Host gitoriousmirror User git Hostname gitorious.org IdentityFile /home/eric/.ssh/id_dsa_gitorious_mirroring [/cc] Save the config file and open your public key file so you can copy the SSH key to your Gitorious account. [cc lang=&quot;bash&quot;] vim id_dsa_gitorious_mirroring.pub [/cc] On Gitorious, go to your Dashboard and click &quot;Manage SSH Keys.&quot;  Then click &quot;Add SSH Key&quot; and copy the contents of your public key into the textarea provided.  This makes it so Gitorious will accept pushes from your server. Set up Gitorious as a remote Your server&#39;s repository is now set up to clone from WordPress and it knows what SSH key to send to Gitorious.  Now we tell it how to talk to Gitorious. [cc lang=&quot;bash&quot;] cd ~ cd /var/www/git/daybreak/ git remote add origin git@gitoriousmirror:daybreak/core.git [/cc] Now we push to Gitorious. [cc lang=&quot;bash&quot;] git push origin master [/cc] Voila!  You&#39;ve just pushed from Subversion to Git.  Doing so again is as simple as rebasing the repository and pushing back: [cc lang=&quot;bash&quot;] git svn rebase git gc git push origin master [/cc] Configure your cron job This is the vital step that was missing from all the other tutorials I read.  I&#39;m not a Linux guy, so &quot;just add this script&quot; doesn&#39;t tell me where or how to do it.  I&#39;d never configured a cron job before, so I was in way over my head.  But I did eventually figure it out ... so learn from my mistakes. Lesson 1: Don&#39;t do anything as root I was running everything as the root user.  Coming from Windows, I&#39;m used to always doing things as the system administrator.  But everyone I asked for help immediately said, &quot;don&#39;t run as root, that&#39;s a big no-no.&quot;  I&#39;m not sure if it is, but I created a new user anyway and did everything from that account instead. Lesson 2: Remember where you installed git My first attempt at writing a script was just using the same commands as above and invoking Git directly.  But Git wasn&#39;t installed that way and cron was throwing errors because the system didn&#39;t know what I was talking about.  So I eventually created a file named `wordpress.sh` in my `/etc` folder.  Just use vim to do the same. [cc lang=&quot;vim&quot;] #!/bin/bash cd /var/www/git/daybreak /usr/bin/git/git checkout wordpress /usr/bin/git/git svn rebase /usr/bin/git/git gc /usr/bin/git/git push origin wordpress [/cc] This script jumps to my repository&#39;s folder, makes sure I&#39;m on the WordPress branch, rebases from the remote Subversion repository, cleans up some garbage, and pushes the changes to Gitorious.  Quick, simple, easy to understand. Lesson 3: CentOS Webadmin is your friend I spent many fruitless hours trying to add my cron job through the command line.  Then I remembered CentOS allows cron management from the webadmin control panel.  So I logged in and told it to execute the following command every 15 minutes: [cc lang=&quot;bash&quot;] sh /etc/wordpress.sh [/cc] And just like that, everything works! You can now follow WordPress core development live (at least within 15 minutes) through the WordPress branch of my Daybreak project on Gitorious!" />
<meta property="og:description" content="For years, I used shared hosting systems exclusively for all my websites.  They were affordable, easy to manage, and required zero effort on my part to set up and maintain.  Unfortunately, I have a habit of rapidly outgrowing hosts and usually have to migrate to bigger and better servers about once a year.  I finally decided to bite the bullet and purchased a VPS hosting system with a great company called Atum last month. The advantage of this is that I have complete control over the VPS.  Whereas before I could only host websites, I can now host my own development repositories (currently rocking Subersion, Mercurial, and Git all on my server).  It protects me from the inevitable crashes of my aging computer systems, and makes life a lot easier for me. While reveling in my newfound power, though, I ran into a serious issue: I had no idea how to set things up! I&#39;d read this or that tutorial and get things off the ground.  Setting up Apache took a few tries.  I&#39;m still working on configuring email.  But the biggest challenge I&#39;ve faced thus far is setting up an automated Subversion-to-Git mirror that would run on a cron job. Recently, I started working on a project that needed to maintain an up-to-date mirror of WordPress&#39; Subversion repository ... in a Git repository.  It&#39;s easy enough to use git-svn to synchronize the repositories.  That I figured out pretty quick.  The challenge lies in automating the process.  It took me a month to figure out the right way to set up a cron job.  So, to save you the trouble, here&#39;s the process I took, heavily derived from steps outlined by Bob McWhirter. Set up the hosted repository My team elected to work with Gitorious.  It&#39;s a site that hosts public Git repositories for free, and it&#39;s not as crowded as GitHub.  So the first step is to set up an empty repository there.  You&#39;ll be pushing all of your Subversion stuff into it.  Mine is called &quot;Daybreak:&quot; http://gitorious.org/daybreak Set up a Git repository on your server Remember, the point here is to automate everything.  So we need to set up a Git repository on our server so the server can grab from Subversion and push it into Gitorious.  Log in to your server via SSH and make an empty repository somewhere: [cc lang=&quot;bash&quot;] cd /var/www/git/ mkdir daybreak cd daybreak git init [/cc] Next we need to tell the repository that it&#39;s cloning from a Subversion system and which branch to take up. [cc lang=&quot;bash&quot;] git svn init -T http://core.svn.wordpress.org/trunk/ [/cc] The -T reminds Git to grab trunk, only trunk, and nothing but trunk.  Yes, you could clone the branches as well, but I only want the latest development version in my repository.  That&#39;s what I&#39;m working with and everything else is noise. At this point, we have a Git repository with nothing in it.  We need to tell it to fetch the Subversion revision history, but here is where you need to be careful! WordPress has over 17,000 commits in core.  If you try to fetch everything, the task might never complete.  I say &quot;never&quot; because I tried ... walked away from the computer for several hours ... and came back to see I was still on revision 2,000.  Trust me, you won&#39;t ever need to revert that far, so grab a recent revision and fetch from there.  I picked RC3 (revision 17355). [cc lang=&quot;bash&quot;] git svn fetch -r 17355 [/cc] This command might run for a while, depending on how long it&#39;s been between the revision you&#39;re fetching and trunk&#39;s current head.  After it&#39;s done, make sure you run the garbage collector to clean things up a bit. [cc lang=&quot;bash&quot;] git gc [/cc] Set up your SSH credentials Once again, we want the server to be the one pushing these commits into the repository, so we have to do a few things to set up permission.  The first is set up a public/private key pair for use with Gitorious. [cc lang=&quot;bash&quot;] cd ~ ssh-keygen -t dsa -f .ssh/id_dsa_gitorious_mirroring [/cc] I usually go back to the root directory before running commands like this.  I don&#39;t know if there are any negative consequences of running the command elsewhere, this is just what I did. Next we want to edit our SSH configuration to use a &quot;fake&quot; host so any connection to Gitorious uses the key we just made. [cc lang=&quot;bash&quot;] cd /.ssh vim config [/cc] This opens the config file in vim.  You need to add the following: [cc lang=&quot;vim&quot;] Host gitoriousmirror User git Hostname gitorious.org IdentityFile /home/eric/.ssh/id_dsa_gitorious_mirroring [/cc] Save the config file and open your public key file so you can copy the SSH key to your Gitorious account. [cc lang=&quot;bash&quot;] vim id_dsa_gitorious_mirroring.pub [/cc] On Gitorious, go to your Dashboard and click &quot;Manage SSH Keys.&quot;  Then click &quot;Add SSH Key&quot; and copy the contents of your public key into the textarea provided.  This makes it so Gitorious will accept pushes from your server. Set up Gitorious as a remote Your server&#39;s repository is now set up to clone from WordPress and it knows what SSH key to send to Gitorious.  Now we tell it how to talk to Gitorious. [cc lang=&quot;bash&quot;] cd ~ cd /var/www/git/daybreak/ git remote add origin git@gitoriousmirror:daybreak/core.git [/cc] Now we push to Gitorious. [cc lang=&quot;bash&quot;] git push origin master [/cc] Voila!  You&#39;ve just pushed from Subversion to Git.  Doing so again is as simple as rebasing the repository and pushing back: [cc lang=&quot;bash&quot;] git svn rebase git gc git push origin master [/cc] Configure your cron job This is the vital step that was missing from all the other tutorials I read.  I&#39;m not a Linux guy, so &quot;just add this script&quot; doesn&#39;t tell me where or how to do it.  I&#39;d never configured a cron job before, so I was in way over my head.  But I did eventually figure it out ... so learn from my mistakes. Lesson 1: Don&#39;t do anything as root I was running everything as the root user.  Coming from Windows, I&#39;m used to always doing things as the system administrator.  But everyone I asked for help immediately said, &quot;don&#39;t run as root, that&#39;s a big no-no.&quot;  I&#39;m not sure if it is, but I created a new user anyway and did everything from that account instead. Lesson 2: Remember where you installed git My first attempt at writing a script was just using the same commands as above and invoking Git directly.  But Git wasn&#39;t installed that way and cron was throwing errors because the system didn&#39;t know what I was talking about.  So I eventually created a file named `wordpress.sh` in my `/etc` folder.  Just use vim to do the same. [cc lang=&quot;vim&quot;] #!/bin/bash cd /var/www/git/daybreak /usr/bin/git/git checkout wordpress /usr/bin/git/git svn rebase /usr/bin/git/git gc /usr/bin/git/git push origin wordpress [/cc] This script jumps to my repository&#39;s folder, makes sure I&#39;m on the WordPress branch, rebases from the remote Subversion repository, cleans up some garbage, and pushes the changes to Gitorious.  Quick, simple, easy to understand. Lesson 3: CentOS Webadmin is your friend I spent many fruitless hours trying to add my cron job through the command line.  Then I remembered CentOS allows cron management from the webadmin control panel.  So I logged in and told it to execute the following command every 15 minutes: [cc lang=&quot;bash&quot;] sh /etc/wordpress.sh [/cc] And just like that, everything works! You can now follow WordPress core development live (at least within 15 minutes) through the WordPress branch of my Daybreak project on Gitorious!" />
<meta property="og:site_name" content="Things that Matter Most" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2011-02-11T08:00:56-08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="A Rookie Attempt at Cron in CentOS" />
<meta name="twitter:site" content="@" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"A Rookie Attempt at Cron in CentOS","dateModified":"2011-02-11T08:00:56-08:00","datePublished":"2011-02-11T08:00:56-08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/tech/rookie-attempt-cron-centos/"},"url":"/tech/rookie-attempt-cron-centos/","description":"For years, I used shared hosting systems exclusively for all my websites.  They were affordable, easy to manage, and required zero effort on my part to set up and maintain.  Unfortunately, I have a habit of rapidly outgrowing hosts and usually have to migrate to bigger and better servers about once a year.  I finally decided to bite the bullet and purchased a VPS hosting system with a great company called Atum last month. The advantage of this is that I have complete control over the VPS.  Whereas before I could only host websites, I can now host my own development repositories (currently rocking Subersion, Mercurial, and Git all on my server).  It protects me from the inevitable crashes of my aging computer systems, and makes life a lot easier for me. While reveling in my newfound power, though, I ran into a serious issue: I had no idea how to set things up! I&#39;d read this or that tutorial and get things off the ground.  Setting up Apache took a few tries.  I&#39;m still working on configuring email.  But the biggest challenge I&#39;ve faced thus far is setting up an automated Subversion-to-Git mirror that would run on a cron job. Recently, I started working on a project that needed to maintain an up-to-date mirror of WordPress&#39; Subversion repository ... in a Git repository.  It&#39;s easy enough to use git-svn to synchronize the repositories.  That I figured out pretty quick.  The challenge lies in automating the process.  It took me a month to figure out the right way to set up a cron job.  So, to save you the trouble, here&#39;s the process I took, heavily derived from steps outlined by Bob McWhirter. Set up the hosted repository My team elected to work with Gitorious.  It&#39;s a site that hosts public Git repositories for free, and it&#39;s not as crowded as GitHub.  So the first step is to set up an empty repository there.  You&#39;ll be pushing all of your Subversion stuff into it.  Mine is called &quot;Daybreak:&quot; http://gitorious.org/daybreak Set up a Git repository on your server Remember, the point here is to automate everything.  So we need to set up a Git repository on our server so the server can grab from Subversion and push it into Gitorious.  Log in to your server via SSH and make an empty repository somewhere: [cc lang=&quot;bash&quot;] cd /var/www/git/ mkdir daybreak cd daybreak git init [/cc] Next we need to tell the repository that it&#39;s cloning from a Subversion system and which branch to take up. [cc lang=&quot;bash&quot;] git svn init -T http://core.svn.wordpress.org/trunk/ [/cc] The -T reminds Git to grab trunk, only trunk, and nothing but trunk.  Yes, you could clone the branches as well, but I only want the latest development version in my repository.  That&#39;s what I&#39;m working with and everything else is noise. At this point, we have a Git repository with nothing in it.  We need to tell it to fetch the Subversion revision history, but here is where you need to be careful! WordPress has over 17,000 commits in core.  If you try to fetch everything, the task might never complete.  I say &quot;never&quot; because I tried ... walked away from the computer for several hours ... and came back to see I was still on revision 2,000.  Trust me, you won&#39;t ever need to revert that far, so grab a recent revision and fetch from there.  I picked RC3 (revision 17355). [cc lang=&quot;bash&quot;] git svn fetch -r 17355 [/cc] This command might run for a while, depending on how long it&#39;s been between the revision you&#39;re fetching and trunk&#39;s current head.  After it&#39;s done, make sure you run the garbage collector to clean things up a bit. [cc lang=&quot;bash&quot;] git gc [/cc] Set up your SSH credentials Once again, we want the server to be the one pushing these commits into the repository, so we have to do a few things to set up permission.  The first is set up a public/private key pair for use with Gitorious. [cc lang=&quot;bash&quot;] cd ~ ssh-keygen -t dsa -f .ssh/id_dsa_gitorious_mirroring [/cc] I usually go back to the root directory before running commands like this.  I don&#39;t know if there are any negative consequences of running the command elsewhere, this is just what I did. Next we want to edit our SSH configuration to use a &quot;fake&quot; host so any connection to Gitorious uses the key we just made. [cc lang=&quot;bash&quot;] cd /.ssh vim config [/cc] This opens the config file in vim.  You need to add the following: [cc lang=&quot;vim&quot;] Host gitoriousmirror User git Hostname gitorious.org IdentityFile /home/eric/.ssh/id_dsa_gitorious_mirroring [/cc] Save the config file and open your public key file so you can copy the SSH key to your Gitorious account. [cc lang=&quot;bash&quot;] vim id_dsa_gitorious_mirroring.pub [/cc] On Gitorious, go to your Dashboard and click &quot;Manage SSH Keys.&quot;  Then click &quot;Add SSH Key&quot; and copy the contents of your public key into the textarea provided.  This makes it so Gitorious will accept pushes from your server. Set up Gitorious as a remote Your server&#39;s repository is now set up to clone from WordPress and it knows what SSH key to send to Gitorious.  Now we tell it how to talk to Gitorious. [cc lang=&quot;bash&quot;] cd ~ cd /var/www/git/daybreak/ git remote add origin git@gitoriousmirror:daybreak/core.git [/cc] Now we push to Gitorious. [cc lang=&quot;bash&quot;] git push origin master [/cc] Voila!  You&#39;ve just pushed from Subversion to Git.  Doing so again is as simple as rebasing the repository and pushing back: [cc lang=&quot;bash&quot;] git svn rebase git gc git push origin master [/cc] Configure your cron job This is the vital step that was missing from all the other tutorials I read.  I&#39;m not a Linux guy, so &quot;just add this script&quot; doesn&#39;t tell me where or how to do it.  I&#39;d never configured a cron job before, so I was in way over my head.  But I did eventually figure it out ... so learn from my mistakes. Lesson 1: Don&#39;t do anything as root I was running everything as the root user.  Coming from Windows, I&#39;m used to always doing things as the system administrator.  But everyone I asked for help immediately said, &quot;don&#39;t run as root, that&#39;s a big no-no.&quot;  I&#39;m not sure if it is, but I created a new user anyway and did everything from that account instead. Lesson 2: Remember where you installed git My first attempt at writing a script was just using the same commands as above and invoking Git directly.  But Git wasn&#39;t installed that way and cron was throwing errors because the system didn&#39;t know what I was talking about.  So I eventually created a file named `wordpress.sh` in my `/etc` folder.  Just use vim to do the same. [cc lang=&quot;vim&quot;] #!/bin/bash cd /var/www/git/daybreak /usr/bin/git/git checkout wordpress /usr/bin/git/git svn rebase /usr/bin/git/git gc /usr/bin/git/git push origin wordpress [/cc] This script jumps to my repository&#39;s folder, makes sure I&#39;m on the WordPress branch, rebases from the remote Subversion repository, cleans up some garbage, and pushes the changes to Gitorious.  Quick, simple, easy to understand. Lesson 3: CentOS Webadmin is your friend I spent many fruitless hours trying to add my cron job through the command line.  Then I remembered CentOS allows cron management from the webadmin control panel.  So I logged in and told it to execute the following command every 15 minutes: [cc lang=&quot;bash&quot;] sh /etc/wordpress.sh [/cc] And just like that, everything works! You can now follow WordPress core development live (at least within 15 minutes) through the WordPress branch of my Daybreak project on Gitorious!","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    

    <!-- Site Favicon -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico" type="image/png" />

    <!-- Font Embed Code -->
	<link href="https://fonts.googleapis.com/css?family=Crimson+Text:400,400i,600,600i|Karla:400,400i,700,700i" rel="stylesheet">

    <!-- CSS Styles -->
    <link href="/assets/css/style.css" rel="stylesheet">
</head>



<body class="layout-post">
    <div id="page" class="site">
        <header id="masthead" class="site-header">
    <div class="site-header-wrap">
        <div class="site-header-inside">

            <div class="site-branding">
                
                <p class="profile">
                    <a href="/">
                        <img src="/assets/images/authorimage.jpg" alt="'s Picture"
                            class="avatar" />
                    </a>
                </p>
                <div class="site-identity">
                    
                    <h1 class="site-title">
                        <a href="/">Things that Matter Most</a>
                    </h1>
                    
                    
                    <p class="site-description">Things that Matter Most</p>
                    
                </div><!-- .site-identity -->
                
                <button id="menu-toggle" class="menu-toggle"><span class="screen-reader-text">Main Menu</span><span
                        class="icon-menu" aria-hidden="true"></span></button>
            </div><!-- .site-branding -->

            <nav id="main-navigation" class="site-navigation" aria-label="Main Navigation">
                <div class="site-nav-wrap">
                    <div class="site-nav-inside">
                    <ul class="menu">
                        
                        
                        
                        <li class="menu-item "><a href="/">Home</a></li>
                        
                        
                        
                        <li class="menu-item "><a href="/about">About</a></li>
                        
                        
                        
                        <li class="menu-item "><a href="/contact">Contact Me</a></li>
                        
                        
                        
                        <li class="menu-item "><a href="/search">Search</a></li>
                        
                    </ul>
                    <p class="social-links">
    
    <a href="https://twitter.com/ericmann" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
<!--
Font Awesome Free 5.5.0 by @fontawesome - https://fontawesome.com
License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
-->
    </a>
    
    
    
    <a href="https://github.com/ericmann" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
<!--
Font Awesome Free 5.5.0 by @fontawesome - https://fontawesome.com
License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
-->
    </a>
    
    
    
    
    
    
    
    <a href="https://www.linkedin.com/in/ericallenmann" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
<!--
Font Awesome Free 5.5.0 by @fontawesome - https://fontawesome.com
License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
-->
    </a>
    
    
    
</p>
                    </div><!-- .site-nav-inside -->
                </div><!-- .site-nav-wrap -->
            </nav><!-- .site-navigation -->

        </div><!-- .site-header-inside -->
    </div><!-- .site-header-wrap -->
</header><!-- .site-header -->
        <div id="content" class="site-content fadeInDown delay_075s">
            <div class="inner-wide">
                <main id="main" class="site-main">

    <article class="post-full inner">

        <header class="post-header">
            <div class="post-meta">
                <time class="post-date" datetime="2011-02-11">
                    February 11, 2011
                </time>
            </div><!-- .post-meta -->
            <h1 class="post-title">A Rookie Attempt at Cron in CentOS</h1>
        </header><!-- .post-header -->

        
        <div class="post-content">
            <p>For years, I used shared hosting systems exclusively for all my websites.  They were affordable, easy to manage, and required zero effort on my part to set up and maintain.  Unfortunately, I have a habit of rapidly outgrowing hosts and usually have to migrate to bigger and better servers about once a year.  I finally decided to bite the bullet and purchased a VPS hosting system with a great company called <a href="http://www.atum.com" target="_blank">Atum </a>last month.</p>
<p>The advantage of this is that I have complete control over the VPS.  Whereas before I could only host websites, I can now host my own development repositories (currently rocking Subersion, Mercurial, and Git all on my server).  It protects me from the inevitable crashes of my aging computer systems, and makes life a lot easier for me.</p>
<p>While reveling in my newfound power, though, I ran into a serious issue: <em>I had no idea how to set things up!</em></p>
<p>I'd read this or that tutorial and get things off the ground.  Setting up Apache took a few tries.  I'm still working on configuring email.  But the biggest challenge I've faced thus far is setting up an automated Subversion-to-Git mirror that would run on a cron job.</p>
<p>Recently, I started working on a project that needed to maintain an up-to-date mirror of WordPress' Subversion repository ... in a Git repository.  It's easy enough to use <a title="git-svn" href="http://www.kernel.org/pub/software/scm/git/docs/git-svn.html" target="_blank">git-svn</a> to synchronize the repositories.  That I figured out pretty quick.  The challenge lies in <em>automating</em> the process.  It took me a month to figure out the right way to set up a cron job.  So, to save you the trouble, here's the process I took, heavily derived from <a href="http://www.fnokd.com/2008/08/20/mirroring-svn-repository-to-github/" target="_blank">steps outlined by Bob McWhirter</a>.</p>
<h2>Set up the hosted repository</h2>
<p>My team elected to work with <a href="http://gitorious.org" target="_blank">Gitorious</a>.  It's a site that hosts public Git repositories for free, and it's not as crowded as GitHub.  So the first step is to set up an empty repository there.  You'll be pushing all of your Subversion stuff into it.  Mine is called "Daybreak:"</p>
<p><a href="http://gitorious.org/daybreak">http://gitorious.org/daybreak</a></p>
<h2>Set up a Git repository on your server</h2>
<p>Remember, the point here is to <em>automate</em> everything.  So we need to set up a Git repository on our server so the server can grab from Subversion and push it into Gitorious.  Log in to your server via SSH and make an empty repository somewhere:</p>
<p>[cc lang="bash"]<br />
cd /var/www/git/<br />
mkdir daybreak<br />
cd daybreak<br />
git init<br />
[/cc]</p>
<p>Next we need to tell the repository that it's cloning from a Subversion system and which branch to take up.</p>
<p>[cc lang="bash"]<br />
git svn init -T http://core.svn.wordpress.org/trunk/<br />
[/cc]</p>
<p>The -T reminds Git to grab trunk, only trunk, and nothing but trunk.  Yes, you could clone the branches as well, but I only want the latest development version in my repository.  That's what I'm working with and everything else is noise.</p>
<p>At this point, we have a Git repository with nothing in it.  We need to tell it to fetch the Subversion revision history, <em>but here is where you need to be careful!</em> WordPress has over 17,000 commits in core.  If you try to fetch everything, the task might never complete.  I say "never" because I tried ... walked away from the computer for several hours ... and came back to see I was still on revision 2,000.  Trust me, you won't ever need to revert that far, so grab a recent revision and fetch from there.  I picked RC3 (revision 17355).</p>
<p>[cc lang="bash"]<br />
git svn fetch -r 17355<br />
[/cc]</p>
<p>This command might run for a while, depending on how long it's been between the revision you're fetching and trunk's current head.  After it's done, make sure you run the garbage collector to clean things up a bit.</p>
<p>[cc lang="bash"]<br />
git gc<br />
[/cc]</p>
<h2>Set up your SSH credentials</h2>
<p>Once again, we want the <em>server</em> to be the one pushing these commits into the repository, so we have to do a few things to set up permission.  The first is set up a public/private key pair for use with Gitorious.</p>
<p>[cc lang="bash"]<br />
cd ~<br />
ssh-keygen -t dsa -f .ssh/id_dsa_gitorious_mirroring<br />
[/cc]</p>
<p>I usually go back to the root directory before running commands like this.  I don't know if there are any negative consequences of running the command elsewhere, this is just what <em>I</em> did.</p>
<p>Next we want to edit our SSH configuration to use a "fake" host so any connection to Gitorious uses the key we just made.</p>
<p>[cc lang="bash"]<br />
cd /.ssh<br />
vim config<br />
[/cc]</p>
<p>This opens the config file in vim.  You need to add the following:</p>
<p>[cc lang="vim"]<br />
Host gitoriousmirror<br />
User git<br />
Hostname gitorious.org<br />
IdentityFile /home/eric/.ssh/id_dsa_gitorious_mirroring<br />
[/cc]</p>
<p>Save the config file and open your public key file so you can copy the SSH key to your Gitorious account.</p>
<p>[cc lang="bash"]<br />
vim id_dsa_gitorious_mirroring.pub<br />
[/cc]</p>
<p>On Gitorious, go to your Dashboard and click "Manage SSH Keys."  Then click "Add SSH Key" and copy the contents of your public key into the textarea provided.  This makes it so Gitorious will accept pushes from your server.</p>
<h2>Set up Gitorious as a remote</h2>
<p>Your server's repository is now set up to clone from WordPress and it knows what SSH key to send to Gitorious.  Now we tell it <em>how</em> to talk to Gitorious.</p>
<p>[cc lang="bash"]<br />
cd ~<br />
cd /var/www/git/daybreak/<br />
git remote add origin git@gitoriousmirror:daybreak/core.git<br />
[/cc]</p>
<p>Now we push to Gitorious.</p>
<p>[cc lang="bash"]<br />
git push origin master<br />
[/cc]</p>
<p>Voila!  You've just pushed from Subversion to Git.  Doing so again is as simple as rebasing the repository and pushing back:</p>
<p>[cc lang="bash"]<br />
git svn rebase<br />
git gc<br />
git push origin master<br />
[/cc]</p>
<h2>Configure your cron job</h2>
<p>This is the vital step that was missing from all the other tutorials I read.  I'm not a Linux guy, so "just add this script" doesn't tell me where or how to do it.  I'd never configured a cron job before, so I was in <em>way</em> over my head.  But I did eventually figure it out ... so learn from my mistakes.</p>
<h3>Lesson 1: Don't do anything as root</h3>
<p>I was running everything as the root user.  Coming from Windows, I'm used to <em>always</em> doing things as the system administrator.  But everyone I asked for help immediately said, "don't run as root, that's a big no-no."  I'm not sure if it is, but I created a new user anyway and did everything from that account instead.</p>
<h3>Lesson 2: Remember where you installed git</h3>
<p>My first attempt at writing a script was just using the same commands as above and invoking Git directly.  But Git wasn't installed that way and cron was throwing errors because the system didn't know what I was talking about.  So I eventually created a file named `wordpress.sh` in my `/etc` folder.  Just use vim to do the same.</p>
<p>[cc lang="vim"]<br />
#!/bin/bash<br />
cd /var/www/git/daybreak<br />
/usr/bin/git/git checkout wordpress<br />
/usr/bin/git/git svn rebase<br />
/usr/bin/git/git gc<br />
/usr/bin/git/git push origin wordpress<br />
[/cc]</p>
<p>This script jumps to my repository's folder, makes sure I'm on the WordPress branch, rebases from the remote Subversion repository, cleans up some garbage, and pushes the changes to Gitorious.  Quick, simple, easy to understand.</p>
<p>Lesson 3: CentOS Webadmin is your friend</p>
<p>I spent many fruitless hours trying to add my cron job through the command line.  Then I remembered CentOS allows cron management from the webadmin control panel.  So I logged in and told it to execute the following command every 15 minutes:</p>
<p>[cc lang="bash"]<br />
sh /etc/wordpress.sh<br />
[/cc]</p>
<p>And just like that, everything works!</p>
<p>You can now follow WordPress core development live (at least within 15 minutes) through the <a href="http://gitorious.org/daybreak/core/commits/wordpress" target="_blank">WordPress branch of my Daybreak project</a> on Gitorious!</p>

        </div>
        <footer class="post-footer">
            <div class="post-share">
                <span class="post-share-title">Share:</span>
                <a target="_blank"
                    href="https://twitter.com/share?text=A+Rookie+Attempt+at+Cron+in+CentOS&amp;url=https://ttmm.iotech/rookie-attempt-cron-centos/">Twitter</a>
                <a target="_blank"
                    href="https://www.facebook.com/sharer/sharer.php?u=https://ttmm.iotech/rookie-attempt-cron-centos/">Facebook</a>
            </div><!-- .share-post -->
            
            <p class="post-cats">
                <span class="post-share-title">Filed under </span>
                <a href="/categories/index.html#Technology"
                    rel="category">Technology</a>
                
            </p>
            
            
            <p class="post-tags">
                <span class="post-share-title">Tagged with </span>
                <a href="/tags/index.html#Linux"
                    rel="tag">Linux</a>
                <a href="/tags/index.html#server"
                    rel="tag">server</a>
                <a href="/tags/index.html#sysadmin"
                    rel="tag">sysadmin</a>
                
            </p>
            
        </footer>
        
    </article>
    
    <section class="read-next inner">
        <h2 class="read-next-title">Read Next</h2>
        
        <article class="post">
            <header class="post-header">
                <div class="post-meta">
                    <time class="published" datetime="February 4, 2011">February 4, 2011</time>
                </div>
                <h3 class="post-title"><a href="/tech/wordpress-and-ajax/">WordPress and Ajax</a>
                </h3>
            </header>
        </article>
        
        
        <article class="post">
            <header class="post-header">
                <div class="post-meta">
                    <time class="published" datetime="February 14, 2011">February 14, 2011</time>
                </div>
                <h3 class="post-title"><a href="/tech/the-death-of-the-idea/">The Death of the Idea</a></h3>
            </header>
        </article>
        
    </section><!-- .read-next -->

</main><!-- .site-main -->


                

                
                <footer id="colophon" class="site-footer">
    <p class="site-info inner">
        <a href="#">Things that Matter Most</a> &copy; 2021. Royce theme by
        <a target="_blank" href="https://justgoodthemes.com/">JustGoodThemes</a>.
        <br />
        Powered by <a target="_blank" href="https://jekyllrb.com/">Jekyll</a>.
    </p>
    <a id="back-to-top" class="back-to-top" href="#page">
        <span class="icon-arrow-up" aria-hidden="true"></span>
        <span class="screen-reader-text">Back to top</span>
    </a>
</footer><!-- .site-footer -->
            </div><!-- .inner-wide -->
        </div><!-- .site-content -->
    </div><!-- .site -->

    
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-4156949-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-4156949-6', { 'anonymize_ip': true });
  </script>

    <!-- Javascript Assets -->
    <script src="/assets/js/jquery-3.3.1.min.js"></script>
    <script src="/assets/js/plugins.js"></script>
    <script src="/assets/js/custom.js"></script>

</body>

</html>